<!DOCTYPE html>
<html>

<head>
  <title>Getting started - Underscore.map.reduce and revealing module pattern</title>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore.js"></script>
</head>

<body>
  <div>Example output:</div>
  <div id="output"></div>
  <script>
    var awardAgeCalculator = (function() {
      var getPeople = function() {
        return [{
          name: "Herta Muller",
          birthYear: 1953,
          awardYear: 2009
        }, {
          name: "Mario Vargas Llosa",
          birthYear: 1936,
          awardYear: 2010
        }, {
          name: "Tomas Transtromer",
          birthYear: 1931,
          awardYear: 2011
        }, {
          name: "Mo Yan",
          birthYear: 1955,
          awardYear: 2012
        }, {
          name: "Alice Munro",
          birthYear: 1931,
          awardYear: 2013
        }, {
          name: "Patrick Modiano",
          birthYear: 1945,
          awardYear: 2014
        }];
      };

      var getPeopleWithAwardAge = function() {
        return _.map(getPeople(), function(person) {
          return {
            name: person.name,
            awardAge: person.awardYear - person.birthYear
          };
        });
      };

      return {
        getPeopleWithAwardAge: getPeopleWithAwardAge,
        getAverageAwardAge: function() {
          var peopleWithAwardAge = getPeopleWithAwardAge();
          return _.reduce(peopleWithAwardAge, function(memo, person) {
            return memo + person.awardAge;
          }, 0) / peopleWithAwardAge.length;
        }
      };
    }());

    $(document).ready(function() {
      $("#output").html("<br />Award age for people:");
      _.each(awardAgeCalculator.getPeopleWithAwardAge(), function(person) {
        var existingContent = $("#output").html();
        var newContent = " - " + person.name + " was " + person.awardAge + " years old";
        $("#output").html(existingContent + "<br />" + newContent);
      });

      $("#output").html($("#output").html() + "<br /><br />" + "Average award age is " + Math.floor(awardAgeCalculator.getAverageAwardAge()) + " years old.");
    });

    console.log(people.length);
  </script>
</body>

</html>
